@model Karta
@{
    ViewData["Title"] = "Index";
}

<h1>Rezervacija karte</h1>

<div style="background-image: url('@Model.Projekcija.Film.PutanjaBackPostera')" class="container prva-slika">
    <div class="zanr">
    </div>
    <div class="PosterFilma">
        <img src="@Model.Projekcija.Film.PutanjaPostera" alt="" class="movie-img" style="width:200px;">
    </div>
    <div class="col-md-6 left-box">
    </div>
</div>
<div class="container movie-details">
    <div class="opisfilma">
        <h2>@Model.Projekcija.Film.Naziv</h2>
        <p> @Model.Projekcija.Film.OpisFilma</p>
    </div>

    <div class="dugmad" style="display:inline-block">
        <div class="col-md-6 left-box div1">
            <p> @Model.Projekcija.VremeProjekcije</p>
            <p> @Model.Projekcija.VremeKrajaProjekcije</p>
            <p>Sala: @Model.Projekcija.Sala.NazivSale</p>
        </div>
        <div class="div2">
            <div class="duzinaTrajanja"><i class="far fa-clock" aria-hidden="true"></i> @Model.Projekcija.Film.Trajanje.ToString()min</div>
            <div class="GodinaIzlaska"><i class="fa fa-calendar" aria-hidden="true"> </i> @Model.Projekcija.Film.Godina.ToString() </div>
        </div>
    </div>
</div>

<hr />
<div class="row">
    <div class="w-100 p-3">
        <form asp-action="Create" method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label class="control-label">Korisnik: @Model.Korisnik.Ime @Model.Korisnik.Prezime</label>

            </div>
            <div class="form-group">
                <label class="control-label">Sala: @Model.Projekcija.Sala.NazivSale </label>
            </div>
            <div class="form-group">
                <label class="control-label">Broj Karti </label>
                <input type="number" />
            </div>
            

            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>


<h3> Izaberite ponudjena sedista:</h3>
    <div id="holder">
        <ul id="place">
        </ul>
    </div>
    <div style="float:left;">
        <ul id="seatDescription">
            <li style="background:url('/img/available_seat_img.gif') no-repeat scroll 0 0 transparent;">Available Seat</li>
            <li style="background:url('/img/booked_seat_img.gif') no-repeat scroll 0 0 transparent;">Booked Seat</li>
            <li style="background:url('/img/selected_seat_img.gif') no-repeat scroll 0 0 transparent;">Selected Seat</li>
        </ul>
    </div>
    <div style="clear:both;width:100%">
        <input type="button" id="btnShowNew" value="Show Selected Seats" />
        <input type="button" id="btnShow" value="Show All" />
    </div>

@section Scripts {
    <script>
        var settings = {
            rows: @Model.Projekcija.Sala.BrojRedova,
            cols: @Model.Projekcija.Sala.BrojKolona,
            rowCssPrefix: 'row-',
            colCssPrefix: 'col-',
            seatWidth: 40,
            seatHeight: 40,
            seatCss: 'seat',
            selectedSeatCss: 'selectedSeat',
            selectingSeatCss: 'selectingSeat'
        };
        var init = function (reservedSeat) {
            var str = [], seatNo, className;
            for (i = 0; i < settings.rows; i++) {
                for (j = 0; j < settings.cols; j++) {
                    seatNo = (i + j * settings.rows + 1);
                    className = settings.seatCss + ' ' + settings.rowCssPrefix + i.toString() + ' ' + settings.colCssPrefix + j.toString();
                    if ($.isArray(reservedSeat) && $.inArray(seatNo, reservedSeat) != -1) {
                        className += ' ' + settings.selectedSeatCss;
                    }
                    str.push('<li class="' + className + '"' +
                        'style="top:' + (i * settings.seatHeight).toString() + 'px;left:' + (j * settings.seatWidth).toString() + 'px">' +
                        '<a title="' + seatNo + '">' + seatNo + '</a>' +
                        '</li>');
                }
            }
            $('#place').html(str.join(''));
        };
        //case I: Show from starting
        //init();

        //Case II: If already booked
        var bookedSeats = [5, 10, 25];
        init(bookedSeats);


        $('.' + settings.seatCss).click(function () {
            if ($(this).hasClass(settings.selectedSeatCss)) {
                alert('This seat is already reserved');
            }
            else {
                $(this).toggleClass(settings.selectingSeatCss);
            }
        });

        $('#btnShow').click(function () {
            var str = [];
            $.each($('#place li.' + settings.selectedSeatCss + ' a, #place li.' + settings.selectingSeatCss + ' a'), function (index, value) {
                str.push($(this).attr('title'));
            });
            alert(str.join(','));
        })

        $('#btnShowNew').click(function () {
            var str = [], item;
            $.each($('#place li.' + settings.selectingSeatCss + ' a'), function (index, value) {
                item = $(this).attr('title');
                str.push(item);
            });
            alert(str.join(','));
        })
    </script>
}
